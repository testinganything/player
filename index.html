<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Bypass Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            text-align: center;
            color: #ff0000;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #cc0000;
        }
        #videoContainer {
            margin-top: 20px;
            text-align: center;
        }
        video {
            width: 100%;
            max-width: 800px;
            height: auto;
        }
        #title {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
        }
        #error {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>YouTube Age Restriction Bypass Player</h1>
    <p>Enter a YouTube video URL (e.g., https://www.youtube.com/watch?v=VIDEO_ID):</p>
    <input type="text" id="videoUrl" placeholder="Paste YouTube URL here">
    <button onclick="loadVideo()">Load Video</button>
    <div id="videoContainer"></div>
    <div id="error"></div>

    <script>
        const ACCOUNT_PROXY_SERVER_HOST = 'https://youtube-proxy.zerody.one';
        const UNLOCKABLE_PLAYABILITY_STATUSES = ['AGE_VERIFICATION_REQUIRED', 'AGE_CHECK_REQUIRED', 'CONTENT_CHECK_REQUIRED', 'LOGIN_REQUIRED'];
        const VALID_PLAYABILITY_STATUSES = ['OK', 'LIVE_STREAM_OFFLINE'];

        function parseVideoId(url) {
            const regex = /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        function flattenObject(obj, prefix = '') {
            return Object.keys(obj).reduce((acc, key) => {
                const newKey = prefix ? `${prefix}.${key}` : key;
                const value = obj[key];
                if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                    Object.assign(acc, flattenObject(value, newKey));
                } else {
                    acc[newKey] = value;
                }
                return acc;
            }, {});
        }

        async function getUnlockedPlayerResponse(videoId) {
            // Use TV Embedded Player strategy payload
            const signatureTimestamp = Math.floor(Date.now() / 1000);
            const hl = 'en';
            const payload = {
                context: {
                    client: {
                        clientName: 'TVHTML5_SIMPLY_EMBEDDED_PLAYER',
                        clientVersion: '2.0',
                        clientScreen: 'WATCH',
                        hl: hl,
                    },
                    thirdParty: {
                        embedUrl: 'https://www.youtube.com/',
                    },
                },
                playbackContext: {
                    contentPlaybackContext: {
                        signatureTimestamp: signatureTimestamp,
                    },
                },
                videoId: videoId,
                startTimeSecs: 0,
                racyCheckOk: true,
                contentCheckOk: true,
            };

            const flatPayload = flattenObject(payload);
            const params = new URLSearchParams(flatPayload);
            const proxyUrl = `${ACCOUNT_PROXY_SERVER_HOST}/getPlayer?${params}&client=js`;

            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    throw new Error('Proxy request failed');
                }
                const data = await response.json();
                const status = data.playabilityStatus?.status;
                if (VALID_PLAYABILITY_STATUSES.includes(status)) {
                    return data;
                } else if (UNLOCKABLE_PLAYABILITY_STATUSES.includes(status)) {
                    throw new Error('Age restriction not bypassed');
                } else {
                    throw new Error(`Invalid playability status: ${status}`);
                }
            } catch (err) {
                console.error('Error fetching player response:', err);
                throw err;
            }
        }

        function findBestFormat(streamingData) {
            // Prefer progressive MP4 formats: itag 22 (720p), 18 (360p)
            const preferredItags = [22, 18];
            for (const itag of preferredItags) {
                const format = streamingData.formats.find(f => f.itag === itag);
                if (format && format.url) {
                    return format;
                }
            }
            // Fallback to first available format
            const format = streamingData.formats.find(f => f.url);
            if (format) return format;
            return null;
        }

        async function loadVideo() {
            const urlInput = document.getElementById('videoUrl').value.trim();
            const videoId = parseVideoId(urlInput);
            if (!videoId) {
                document.getElementById('error').textContent = 'Invalid YouTube URL';
                return;
            }

            const errorDiv = document.getElementById('error');
            const container = document.getElementById('videoContainer');
            errorDiv.textContent = '';
            container.innerHTML = '<p>Loading...</p>';

            try {
                const playerResponse = await getUnlockedPlayerResponse(videoId);
                const streamingData = playerResponse.streamingData;
                const videoDetails = playerResponse.videoDetails;
                if (!streamingData || !videoDetails) {
                    throw new Error('No streaming data available');
                }

                const format = findBestFormat(streamingData);
                if (!format) {
                    throw new Error('No playable format found');
                }

                // Create video element
                const video = document.createElement('video');
                video.controls = true;
                video.src = format.url;
                video.type = format.mimeType;

                const title = document.createElement('div');
                title.id = 'title';
                title.textContent = videoDetails.title;

                container.innerHTML = '';
                container.appendChild(title);
                container.appendChild(video);
                video.play();
            } catch (err) {
                container.innerHTML = '';
                errorDiv.textContent = `Error: ${err.message}`;
            }
        }

        // Allow Enter key to load
        document.getElementById('videoUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loadVideo();
        });
    </script>
</body>
</html>
